// LICENSE : MIT
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _assert = require("assert");

var _assert2 = _interopRequireDefault(_assert);

function _getUniformDispatcher(stores) {
    (0, _assert2["default"])(stores && stores.length, 'Must provide at least one store to FluxStoreGroup');
    var dispatcher = stores[0].context.dispatcher;
    if (process.env.NODE_ENV !== 'production') {
        stores.forEach(function (store) {
            (0, _assert2["default"])(store.context.dispatcher === dispatcher, 'All stores in a FluxStoreGroup must use the same dispatcher');
        });
    }
    return dispatcher;
}

var FluxStoreGroup = (function () {
    /**
     * Create StoreGroup
     * @param {MaterialStore[]} stores stores are instance of MaterialStore
     * @param {Function} callback callback is called after store's
     */

    function FluxStoreGroup(stores, callback) {
        var _this = this;

        _classCallCheck(this, FluxStoreGroup);

        this._dispatcher = _getUniformDispatcher(stores);

        // Precompute store tokens.
        var storeTokens = stores.map(function (store) {
            (0, _assert2["default"])(store._token, store.constructor.name + " never register key.\nclass " + store.constructor.name + " extends Store {\n    constructor(..args){\n        super(..args);\n        // Needed!\n        this.register(key, handler);\n    }\n}\n            ");
            return store._token;
        });

        // Register with the dispatcher.
        this._dispatchToken = this._dispatcher.register(function (payload) {
            _this._dispatcher.waitFor(storeTokens);
            callback();
        });
    }

    FluxStoreGroup.prototype.release = function release() {
        this._dispatcher.unregister(this._dispatchToken);
    };

    return FluxStoreGroup;
})();

exports["default"] = FluxStoreGroup;
module.exports = exports["default"];
//# sourceMappingURL=material-store-group.js.map